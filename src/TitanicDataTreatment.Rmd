---
title: "PRA2"
output: html_document
date: '2022-05-16'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Instalamos y cargamos las librerías.
```{r warning=FALSE, message=FALSE}
# https://cran.r-project.org/web/packages/ggplot2/index.html
if (!require('ggplot2')) install.packages('ggplot2'); library('ggplot2')
# https://cran.r-project.org/web/packages/dplyr/index.html
if (!require('dplyr')) install.packages('dplyr'); library('dplyr')
```


## Ejercicio 1

Descripción del dataset. ¿Por qué es importante y qué pregunta/problema pretende
responder?

Cargamos el dataset.
```{r}
df <- read.csv('../data/train.csv',stringsAsFactors = FALSE)
```


Confirmamos que el dataset se ha cargado correctamente:
```{r}
head(df)
```


Descripción del dataset:
```{r}
str(df)
```

Observamos que el conjunto de datos consta de 891 observaciones y 12 variables que describen la tripulación del Titanic.

**PassengerId**
    Número identificador del pasajero (Integer).
    
**Survived**
    Variable que especifica si un pasajero ha sobrevivido. 0 = No, 1 = Si (Integer).
    
**Pclass**
    Clase socio economica del pasajero. 1 = Clase Alta, 2 = Clase Media, 3 = Clase baja (Integer).
    
**Name**
    Nombre del pasajero (String).
    
**Sex**
    Sexo del pasajero (String).
    
**Age**
    Edad del pasajero. Para pasajeros de menos de un año, la edad esta fraccionada. Si la edad esta estimada, su formato es xx.5 (Numeric).

**SibSp**
    Número de familiares, hermanos o esposos, a abordo (Integer).
    
**Parch**
    Número de familiares, padres o hijos, a bordo (Ingeger).
    
**Ticket**
    Número del billete (String).
    
**Fare**
    Precio del billete (Numeric)
    
**Cabin**
    Número de cabina (String).

**Embarked**
    Puerto en el que embarco el pasajero. C = Cherbourg, Q = Queenstown, S = Southampton (String).


#TODO: Traducir y poner bien la respuesta a ¿Por qué es importante y qué pregunta/problema pretende responder?

The sinking of the Titanic is one of the most infamous shipwrecks in history.

On April 15, 1912, during her maiden voyage, the widely considered “unsinkable” RMS Titanic sank after colliding with an iceberg. Unfortunately, there weren’t enough lifeboats for everyone onboard, resulting in the death of 1502 out of 2224 passengers and crew.

While there was some element of luck involved in surviving, it seems some groups of people were more likely to survive than others.

In this challenge, we ask you to build a predictive model that answers the question: “what sorts of people were more likely to survive?” using passenger data (ie name, age, gender, socio-economic class, etc).


## Ejercicio 2

Integración y selección de los datos de interés a analizar. Puede ser el resultado de
adicionar diferentes datasets o una subselección útil de los datos originales, en base al
objetivo que se quiera conseguir.


La principal variable a incluir va a ser **Survived**. Esta será nuestra variable objetivo a predecir.
A continuación querremos seleccionar todas las variables que puedan describir el pasajero, y eliminar las variables irrelevantes. Observando la previa descripción de las variables realizada en el ejercicio 1, rápidamente podemos identificar que las variables **Cabin**, el número de cabina, y **Ticket**, el número del billete, no nos aportan información relevante para describir el pasajero. De mismo modo, la variable **Nombre** tampoco nos aporta información relevante, los pasajeros se identifican de forma única usando la variable **PassengerId**.

Procedemos a descartar las variables irrelevantes.

```{r}
irrelevant <- c("Cabin", "Ticket", "Name")
titanic <- df[ , -which(names(df) %in% irrelevant)]
```


## Ejercicio 3

Limpieza de los datos.

### 3.1 Valores vacios

¿Los datos contienen ceros o elementos vacíos? Gestiona cada uno de estos
casos.


Estadísticas de valores vacíos.

```{r}
colSums(is.na(titanic))
colSums(titanic=="")
```

Observamos 177 valores vacíos en la variable **Age** y 2 valores vacíos en la variable **Embarked**.



Si nos centramos en el caso de la variable **Age**, esta contiene 177 valores vacíos. Como eliminar 177 observaciones del conjunto de datos supondría una gran perdida de información ya que este contiene 801 observaciones, optaremos por la estrategia de completar los valores vacíos usando la media de edad del conjunto de datos. 

```{r}
titanic$Age[is.na(titanic$Age)] <- mean(titanic$Age, na.rm=T)
```


Debido a que la variable **Embarked** tiene solo 2 valores vacíos, no vemos la necesidad de crear una categoría nueva "Desconocido" para substituir los valores vacíos, creemos que la mejor estrategia en este caso, es substituir estos valores vacíos por la categoría más repetida, evitando así la perdida de información que supondría eliminar las observaciones. 

```{r}
# Determinamos la categoría que se repite con mayor frecuencia
table(titanic$Embarked)
```

Observamos que la categoría 'S' es la que se repite con mayor frecuencia.

Procedemos a sustituir los valores vacíos por 'S'.

```{r}
titanic$Embarked[titanic$Embarked == ""] <- "S"
```


Comprobamos que ya no existen valores vacíos en el conjunto de datos.
```{r}
colSums(is.na(titanic))
colSums(titanic=="")
```


### 3.2 Valores extremos

Identifica y gestiona los valores extremos.

Los valores extremos se dan en las variables continuas cuando observamos valores significativamente altos o significativamente bajos, que generan duda sobre su veracidad. 

Observemos las estadísticas básicas del conjunto de datos para identificar posibles valores extremos (*outliers*) en las variables continuas **Age**, **SibSp**, **Parch** y **Fare**.

```{r}
summary(titanic)
```

Observamos que los valores minimos y maximos de la variable **Age**, se mantienen dentro de un rango lógico. **SibSp** y **Parch**, tienen un valor máximo alto, pero parece consistente con los estándares de familias de la época. La variable que será necesária analizar con profundidad es **Fare**. Esta variable contiene un valor máximo muy superior al valor medio.


Utilizaremos la representación *boxplot* para identificar los *outliers* de **Fare**.

```{r}
ggplot(titanic) +
  aes(x = "", y = Fare) +
  geom_boxplot(fill = "#0c4c8a") +
  theme_minimal()
```

Con esta representación, podemos identificar claramente un **outiler** correspondiente al valor máximo de 512.33. Optaremos para eliminar esta observación ya que es sospechosa de contener información no verídica.

```{r}
titanic <- subset(titanic, titanic$Fare < 500)
```



## Ejercicio 4

Análisis de los datos.


### 4.1 Elección de los datos a analizar

Selección de los grupos de datos que se quieren analizar/comparar (p. e., si se
van a comparar grupos de datos, ¿cuáles son estos grupos y qué tipo de análisis
se van a aplicar?)


### 4.2  Normalidad y Homogeneidad

Comprobación de la normalidad y homogeneidad de la varianza.


### 4.3 Análisis

Aplicación de pruebas estadísticas para comparar los grupos de datos. En función
de los datos y el objetivo del estudio, aplicar pruebas de contraste de hipótesis,
correlaciones, regresiones, etc. Aplicar al menos tres métodos de análisis
diferentes


## Ejercicio 5

Representación de los resultados a partir de tablas y gráficas. Este apartado se puede
responder a lo largo de la práctica, sin necesidad de concentrar todas las
representaciones en este punto de la práctica.



## Ejercicio 6


Resolución del problema. A partir de los resultados obtenidos, ¿cuáles son las
conclusiones? ¿Los resultados permiten responder al problema?



## Referencias